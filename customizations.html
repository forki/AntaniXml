<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Customizations
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="xml random generator"/>
    <meta name="author" content="Giacomo Citi"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/AntaniXml/content/style.css" />
    <script type="text/javascript" src="/AntaniXml/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/giacomociti/AntaniXml">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/AntaniXml/index.html">AntaniXml</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Customizations" class="anchor" href="#Customizations">Customizations</a></h1>

<p>This article is about how you can customize the generated output.</p>

<h3><a name="Simply-change-the-output" class="anchor" href="#Simply-change-the-output">Simply change the output</a></h3>

<p>For some schemas the generator may produce something not correct (for example ignoring identity constraints).
Or maybe the generated values simply look ugly to you (you may want meaningful words instead of random gibberish).
Obviously one option is to change the produced output by using XSLT or by any other mean. Since the output is
an <code>XElement</code>, the <code>System.Xml.Linq</code> API is already well suited for this task:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">samples</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="t">Schema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="f">CreateFromUri</span>(<span class="s">&quot;foo&quot;</span>)
          <span class="o">.</span><span class="f">Generator</span>(<span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="t">XmlQualifiedName</span>(<span class="s">&quot;e1&quot;</span>))
          <span class="o">.</span><span class="f">Generate</span>(<span class="n">10</span>)

<span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="i">samples</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="f">mapi</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">i</span> <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="i">xml</span> <span class="k">-&gt;</span>
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs13', 16)" onmouseover="showTip(event, 'fs13', 16)" class="i">bar</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">xml</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 18)" onmouseover="showTip(event, 'fs14', 18)" class="f">Descendants</span>(<span onmouseout="hideTip(event, 'fs15', 19)" onmouseover="showTip(event, 'fs15', 19)" class="t">XName</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 20)" onmouseover="showTip(event, 'fs16', 20)" class="f">Get</span>(<span class="s">&quot;bar&quot;</span>)) <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">bar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 22)" onmouseover="showTip(event, 'fs17', 22)" class="f">Attribute</span>(<span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="t">XName</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="f">Get</span>(<span class="s">&quot;id&quot;</span>))<span class="o">.</span><span class="i">Value</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs11', 25)" onmouseover="showTip(event, 'fs11', 25)" class="i">i</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="f">ToString</span>()
    <span onmouseout="hideTip(event, 'fs12', 27)" onmouseover="showTip(event, 'fs12', 27)" class="i">xml</span>)      
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 28)" onmouseover="showTip(event, 'fs9', 28)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 29)" onmouseover="showTip(event, 'fs19', 29)" class="f">iter</span> (<span onmouseout="hideTip(event, 'fs20', 30)" onmouseover="showTip(event, 'fs20', 30)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%A</span><span class="s">&quot;</span>) 
    
</code></pre></td>
</tr>
</table>

<p>The same in C# is:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span class="i">var</span> <span class="i">samples</span> <span class="o">=</span> <span class="i">Schema</span><span class="o">.</span><span class="i">CreateFromUri</span>(<span class="s">&quot;foo.xsd&quot;</span>)
        <span class="o">.</span><span class="i">Generator</span>(<span class="k">new</span> <span class="i">XmlQualifiedName</span>(<span class="s">&quot;e1&quot;</span>))
        <span class="o">.</span><span class="i">Generate</span>(<span class="n">10</span>);

    <span class="i">samples</span><span class="o">.</span><span class="i">Descendants</span>(<span class="s">&quot;bar&quot;</span>)
        <span class="o">.</span><span class="i">Select</span>((<span class="i">bar</span>, <span class="i">i</span>) <span class="o">=&gt;</span>
            {
                <span class="i">bar</span><span class="o">.</span><span class="i">Attribute</span>(<span class="s">&quot;id&quot;</span>)<span class="o">.</span><span class="i">Value</span> <span class="o">=</span> <span class="i">i</span><span class="o">.</span><span class="i">ToString</span>();
                <span class="k">return</span> <span class="i">bar</span>;
            })
        <span class="o">.</span><span class="i">ToList</span>()
        <span class="o">.</span><span class="i">ForEach</span>(<span class="i">Console</span><span class="o">.</span><span class="i">WriteLine</span>);
</code></pre></td>
</tr>
</table>

<p>The above example is just to get the idea. If you don't like imperative code
you can map the element to another one, but for little fixes the
mutability allowed in <code>System.Xml.Linq</code> may be just fine.</p>

<h3><a name="Providing-you-own-generators" class="anchor" href="#Providing-you-own-generators">Providing you own generators</a></h3>

<p>Allowing custom generators is of course a superior alternative.</p>

<p>To keep things simple, custom generators are allowed only for elements and for global complex types.
The only way to customize the generation of simple types and attributes is to provide generators for
the enclosing elements or global complex types. Hopefully this is an acceptable limitation for most practical purposes.</p>

<p>FsCheck provides excellent documentation about creating custom generators.
Anyway there is also an option to provide only a mapping function, so the default generators are used but the generated elements
are then transformed with a custom function.
Custom generators are expected to produce <code>XElement</code> instances.
In case of complex types the name of the generated element actually is not important because it will be replaced
by the proper element name required in each context.</p>

<h4><a name="Customizing-a-global-complex-type" class="anchor" href="#Customizing-a-global-complex-type">Customizing a global complex type</a></h4>

<p>The qualified name of the complex type is used as an identifier to pick up a custom generator for all the
elements explicitly defined to be of such a type.
Hence only global types can be customized since anonymous types lack a name to be used as an identifier.
Also in case of an element whose anonymous type is derived from a global one for which a customization is provided, 
the custom generator is <em>not</em> picked up.</p>

<h4><a name="Customizing-elements" class="anchor" href="#Customizing-elements">Customizing elements</a></h4>

<p>Custom generators for elements instead may have a broader reach.
When a custom generator is provided for elements with a given qualified name, that generator is used for all
elements with such a name, regardless of their type.
So, in case the schema is designed in a <em>Russian doll</em> style, custom generators for elements are a better bet.
Just beware of (nasty) schemas where two distinct element definitions describe elements with the exact same name 
but different content models. In this case a custom generator may not be used because it would apply to
both element definitions.</p>

<div class="tip" id="fs1">namespace AntaniXml</div>
<div class="tip" id="fs2">namespace System</div>
<div class="tip" id="fs3">namespace System.Xml</div>
<div class="tip" id="fs4">namespace System.Xml.Linq</div>
<div class="tip" id="fs5">val samples : XElement array<br /><br />Full name: Customizations.samples</div>
<div class="tip" id="fs6">Multiple items<br />namespace System.Xml.Schema<br /><br />--------------------<br />type Schema =<br />&#160;&#160;new : xmlSchemaSet:XmlSchemaSet -&gt; Schema<br />&#160;&#160;member Arbitrary : elementName:XmlQualifiedName -&gt; Arbitrary&lt;XElement&gt;<br />&#160;&#160;member Arbitrary : elementName:XmlQualifiedName * customizations:CustomGenerators -&gt; Arbitrary&lt;XElement&gt;<br />&#160;&#160;member Generator : elementName:XmlQualifiedName -&gt; IXmlElementGenerator<br />&#160;&#160;member Validate : element:XElement -&gt; ValidationResult<br />&#160;&#160;member Validate : element:string -&gt; ValidationResult<br />&#160;&#160;member GlobalElements : IEnumerable&lt;XmlQualifiedName&gt;<br />&#160;&#160;static member CreateFromText : schemaText:string -&gt; Schema<br />&#160;&#160;static member CreateFromUri : schemaUri:string -&gt; Schema<br /><br />Full name: AntaniXml.Schema<br /><br />--------------------<br />new : xmlSchemaSet:Schema.XmlSchemaSet -&gt; Schema</div>
<div class="tip" id="fs7">static member Schema.CreateFromUri : schemaUri:string -&gt; Schema</div>
<div class="tip" id="fs8">Multiple items<br />type XmlQualifiedName =<br />&#160;&#160;new : unit -&gt; XmlQualifiedName + 2 overloads<br />&#160;&#160;member Equals : other:obj -&gt; bool<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Name : string<br />&#160;&#160;member Namespace : string<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;static val Empty : XmlQualifiedName<br />&#160;&#160;static member ToString : name:string * ns:string -&gt; string<br /><br />Full name: System.Xml.XmlQualifiedName<br /><br />--------------------<br />XmlQualifiedName() : unit<br />XmlQualifiedName(name: string) : unit<br />XmlQualifiedName(name: string, ns: string) : unit</div>
<div class="tip" id="fs9">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs10">val mapi : mapping:(int -&gt; &#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.mapi</div>
<div class="tip" id="fs11">val i : int</div>
<div class="tip" id="fs12">val xml : XElement</div>
<div class="tip" id="fs13">val bar : XElement</div>
<div class="tip" id="fs14">XContainer.Descendants() : System.Collections.Generic.IEnumerable&lt;XElement&gt;<br />XContainer.Descendants(name: XName) : System.Collections.Generic.IEnumerable&lt;XElement&gt;</div>
<div class="tip" id="fs15">type XName =<br />&#160;&#160;member Equals : obj:obj -&gt; bool<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member LocalName : string<br />&#160;&#160;member Namespace : XNamespace<br />&#160;&#160;member NamespaceName : string<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;static member Get : expandedName:string -&gt; XName + 1 overload<br /><br />Full name: System.Xml.Linq.XName</div>
<div class="tip" id="fs16">XName.Get(expandedName: string) : XName<br />XName.Get(localName: string, namespaceName: string) : XName</div>
<div class="tip" id="fs17">XElement.Attribute(name: XName) : XAttribute</div>
<div class="tip" id="fs18">System.Int32.ToString() : string<br />System.Int32.ToString(provider: System.IFormatProvider) : string<br />System.Int32.ToString(format: string) : string<br />System.Int32.ToString(format: string, provider: System.IFormatProvider) : string</div>
<div class="tip" id="fs19">val iter : action:(&#39;T -&gt; unit) -&gt; source:seq&lt;&#39;T&gt; -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Seq.iter</div>
<div class="tip" id="fs20">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>

        </div>
        <div class="span3">
          <img src="/AntaniXml/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">AntaniXml</li>
            <li><a href="/AntaniXml/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/AntaniXml">Get Library via NuGet</a></li>
            <li><a href="http://github.com/giacomociti/AntaniXml">Source Code on GitHub</a></li>
            <li><a href="/AntaniXml/license.html">License</a></li>
            <li><a href="/AntaniXml/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/AntaniXml/tutorial.html">Tutorial</a></li>
            <li><a href="/AntaniXml/customizations.html">Customizations</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/AntaniXml/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/giacomociti/AntaniXml"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
